<html>
<head>
	<link rel="stylesheet" href="css/stylesheet.css" type="text/css" charset="utf-8">
	<script src="js/jquery-2.0.2.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/jstween-1.1.min.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">

		var timestampOld;
		var timestamp;
		var cTitle1;
		var cTitle2;
		var eName;
		var eLoc;
		var cTwitter1;
		var cTwitter2;

		var xmlDoc;
		var xhr = new XMLHttpRequest();

		var animating = false;
		var doUpdate = false;

		function init(){

			xhr.overrideMimeType('text/xml');

			var timeout = this.window.setInterval(function() {
				pollHandler();
			}, 200);

			$('cTitle1').html('');
			$('cTitle2').html('');
			$('eName').html('');
			$('eLoc').html('');
			$('cTwitter1').html('');
			$('cTwitter2').html('');
			$('#cBoard').tween({
				bottom:{
					start: '-250',
					stop: '0',
					units: 'px',
					time: 0,
					duration: 0.8,
					effect:'easeOut'
				}
			});

			$.play();
		}

		function pollHandler(){
			loadData();
			if (timestamp != timestampOld){
				doUpdate = true;
			}
			if (!animating && doUpdate) {
				updateBoard();
			}
		}

		function loadData() {
			xhr.open('GET', 'streamcontrol.xml');
			xhr.send();
			xhr.onreadystatechange = function(){
				xmlDoc = xhr.responseXML;

				cTitle1 = getValueFromTag(xmlDoc,'cTitle1');
				cTitle2 = getValueFromTag(xmlDoc,'cTitle2');
				eName = getValueFromTag(xmlDoc,'eName');
				eLoc = getValueFromTag(xmlDoc,'eLoc');
				cTwitter1 = getValueFromTag(xmlDoc,'cTwitter1');
				cTwitter2 = getValueFromTag(xmlDoc,'cTwitter2');
				timestampOld = timestamp;
				timestamp = getValueFromTag(xmlDoc,'timestamp');
			}
		}

		function updateBoard(){
			if($('#cTitle1').html() != cTitle1) {
				animating = true;
				$('#cTitle1').tween({
					left:{
						start: 105,
						stop: -200,
						units: 'px',
						time: 0,
						duration: 0.5,
						effect:'easeIn'
					},
					opacity: {
						start: 100,
						stop: 0,
						time: 0,
						duration: 0.5,
						effect: 'easeIn'
					},
					onStop: function(){
						$('#cTitle1').html(cTitle1);
					}
				});

				$('#cTitle1').tween({
					left:{
						start: -200,
						stop: 105,
						units: 'px',
						time: 0.5,
						duration: 0.5,
						effect:'easeOut'
					},
					opacity: {
						start: 0,
						stop: 100,
						time: 0.5,
						duration: 0.5,
						effect: 'easeOut'
					},
					onStop: function(){
						animating = false;
					}
				});
			}

			if($('#cTitle2').html() != cTitle2) {
				animating = true;
				$('#cTitle2').tween({
					left:{
						start: 845,
						stop: 1280,
						units: 'px',
						time: 0,
						duration: 0.5,
						effect:'easeIn'
					},
					opacity: {
						start: 100,
						stop: 0,
						time: 0,
						duration: 0.5,
						effect: 'easeIn'
					},
					onStop: function(){
						$('#cTitle2').html(cTitle2);
					}
				});

				$('#cTitle2').tween({
					left:{
						start: 1280,
						stop: 845,
						units: 'px',
						time: 0.5,
						duration: 0.5,
						effect:'easeOut'
					},
					opacity: {
						start: 0,
						stop: 100,
						time: 0.5,
						duration: 0.5,
						effect: 'easeOut'
					},
					onStop: function(){
						animating = false;
					}
				});
			}

			if($('#cTwitter1').html() != cTwitter1) {
				animating = true;
				$('#cTwitter1').tween({
					left:{
						start: 105,
						stop: -200,
						units: 'px',
						time: 0,
						duration: 0.5,
						effect:'easeIn'
					},
					opacity: {
						start: 100,
						stop: 0,
						time: 0,
						duration: 0.5,
						effect: 'easeIn'
					},
					onStop: function(){
						$('#cTwitter1').html(cTwitter1);
					}
				});

				$('#cTwitter1').tween({
					left:{
						start: -200,
						stop: 105,
						units: 'px',
						time: 0.5,
						duration: 0.5,
						effect:'easeOut'
					},
					opacity: {
						start: 0,
						stop: 100,
						time: 0.5,
						duration: 0.5,
						effect: 'easeOut'
					},
					onStop: function(){
						animating = false;
					}
				});
			}

			if($('#cTwitter2').html() != cTwitter2) {
				animating = true;
				$('#cTwitter2').tween({
					left:{
						start: 845,
						stop: 1280,
						units: 'px',
						time: 0,
						duration: 0.5,
						effect:'easeIn'
					},
					opacity: {
						start: 100,
						stop: 0,
						time: 0,
						duration: 0.5,
						effect: 'easeIn'
					},
					onStop: function(){
						$('#cTwitter2').html(cTwitter2);
					}
				});

				$('#cTwitter2').tween({
					left:{
						start: 1280,
						stop: 845,
						units: 'px',
						time: 0.5,
						duration: 0.5,
						effect:'easeOut'
					},
					opacity: {
						start: 0,
						stop: 100,
						time: 0.5,
						duration: 0.5,
						effect: 'easeOut'
					},
					onStop: function(){
						animating = false;
					}
				});
			}

			if($('#eName').html() != eName) {
				animating = true;
				$('#eName').tween({
					opacity: {
						start: 100,
						stop: 0,
						time: 0,
						duration: 0.5,
						effect: 'easeIn'
					},
					onStop: function(){
						$('#eName').html(eName);
					}
				});

				$('#eName').tween({
					opacity: {
						start: 0,
						stop: 100,
						time: 0.5,
						duration: 0.5,
						effect: 'easeOut'
					},
					onStop: function(){
						animating = false;
					}
				});
			}

			if($('#eLoc').html() != eLoc) {
				animating = true;
				$('#eLoc').tween({
					opacity: {
						start: 100,
						stop: 0,
						time: 0,
						duration: 0.5,
						effect: 'easeIn'
					},
					onStop: function(){
						$('#eLoc').html(eLoc);
					}
				});

				$('#eLoc').tween({
					opacity: {
						start: 0,
						stop: 100,
						time: 0.5,
						duration: 0.5,
						effect: 'easeOut'
					},
					onStop: function(){
						animating = false;
					}
				});
			}

			$.play();

			doUpdate = false;
		}

		function getValueFromTag (xmlDoc,tag) {
			if (xmlDoc.getElementsByTagName(tag).length != 0) {
				if(xmlDoc.getElementsByTagName(tag)[0].childNodes.length == 0) {
					return '';
				}else{
					return xmlDoc.getElementsByTagName(tag)[0].childNodes[0].nodeValue;
				}
			}else{
				return '';
			}
		}
	</script>

</head>
<body onLoad="init()">
	<div id="cBoard">
		<div id="cTitle1"></div>
		<div id="cTitle2"></div>
		<div id="cTwitter1"></div>
		<div id="cTwitter2"></div>
		<div id="eName"></div>
		<div id="eLoc"></div>
	</div>
</body>
</html>
